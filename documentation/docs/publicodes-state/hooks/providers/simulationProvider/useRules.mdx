# `useRules`

## Overview

The `useRules` hook is a powerful utility for extracting and organizing various sets of rules from the Publicodes engine. It leverages memoization to optimize performance by caching the results of complex computations.

## Installation

Ensure you have the necessary dependencies installed:

```bash
npm install @/publicodes-state publicodes
```

## Usage

```typescript
import { useRules } from '@/publicodes-state/hooks/simulationProvider/useRules'
import Engine from 'publicodes'

const engine = new Engine(/* your rules here */)
const root = 'rootRuleName'

const {
  parsedRules,
  everyRules,
  everyInactiveRules,
  everyQuestions,
  everyNotifications,
  everyUiCategories,
  everyMosaicChildrenWithParent,
  rawMissingVariables,
} = useRules({ engine, root })
```

## API

### Parameters

- `engine` (Engine): An instance of the Publicodes engine.
- `root` (string): The root rule name to start the extraction.

### Returns

The hook returns an object with the following properties:

- `parsedRules` (NGCRulesNodes): The parsed rules from the Publicodes engine.
- `everyRules` (string[]): An array of all rule names.
- `everyInactiveRules` (string[]): An array of inactive rule names.
- `everyQuestions` (string[]): An array of rule names that are questions.
- `everyNotifications` (string[]): An array of rule names that are notifications.
- `everyUiCategories` (`string[]`): An array of UI category rule names.
- `everyMosaicChildrenWithParent` (`Record<string, string[]>`): A record of mosaic rules and their children.
- `rawMissingVariables` (`Record<string, number>`): A record of missing variables for the root rule.

## Description

The `useRules` hook performs several key functions:

1. Parses the rules from the Publicodes engine.
2. Categorizes rules into different types (e.g., questions, notifications, UI categories).
3. Identifies inactive rules and mosaic rule relationships.
4. Determines missing variables for the root rule.

This hook is essential for applications that need to work with complex rule sets and require efficient access to various rule categories and relationships.

## Performance Considerations

- The hook uses `useMemo` to cache computed results, improving performance for repeated invocations.
- Be mindful of the size of your rule set, as very large rule sets may impact initial computation time.

## Error Handling

The hook includes error handling to prevent crashes due to invalid rule names or parsing issues. If an error occurs during rule processing, it will be logged to the console.

## Related Hooks

- `useEngine`: For accessing the main Publicodes engine instance.
- `useInternalEngine`: For initializing and managing the Publicodes engine.

## Example

```typescript
const MyComponent = () => {
  const engine = new Engine(myRules)
  const { everyQuestions, everyNotifications } = useRules({ engine, root: 'bilan' })

  return (
    <div>
      <h2>Questions</h2>
      <ul>
        {everyQuestions.map(question => <li key={question}>{question}</li>)}
      </ul>
      <h2>Notifications</h2>
      <ul>
        {everyNotifications.map(notification => <li key={notification}>{notification}</li>)}
      </ul>
    </div>
  )
}
```

## Further Reading

- [Publicodes Documentation](https://publi.codes/)
- [Nos Gestes Climat Model Documentation](https://nosgestesclimat.fr/documentation)
